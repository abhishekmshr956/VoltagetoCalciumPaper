\documentclass[9pt,lineno]{elife}
\usepackage[version=4]{mhchem}
\usepackage{siunitx}
\DeclareSIUnit\Molar{M}

\usepackage{amsmath}
\usepackage{gensymb}
\graphicspath{{images/}}
\usepackage{caption}
\usepackage{subcaption}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% ARTICLE SETUP
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\title{Voltage to Calcium Transformation Improves Direction Selectivity in \textit{Drosophila} T4 neurons}

\author[1*]{Firstname Middlename Surname}
\author[1,2\authfn{1}\authfn{3}]{Firstname Middlename Familyname}
\author[2\authfn{1}\authfn{4}]{Firstname Initials Surname}
\author[2*]{Firstname Surname}
\affil[1]{Max Planck Institute of Neurobiology, Martinsried, Germany}

\corr{email1@example.com}{FMS}
\corr{email2@example.com}{FS}

\contrib[\authfn{1}]{These authors contributed equally to this work}
\contrib[\authfn{2}]{These authors also contributed equally to this work}

\presentadd[\authfn{3}]{Department, Institute, Country}
\presentadd[\authfn{4}]{Department, Institute, Country}

\usepackage[citestyle=authoryear-icomp,bibstyle=nature,ibidtracker=false,sorting=ynt]{biblatex}
\renewcommand{\finentrypunct}{}


\addbibresource{reference.bib}

\begin{document}
\maketitle

%Analyzing how information is transmitted through neurons and synapses is crucial to understand how neural computation is carried out.
\begin{abstract}
A critical step in neural information processing is the transformation of membrane voltage into calcium signals leading to transmitter release. However, the effect of voltage to calcium transformation on neural responses to different sensory stimuli is not well understood. Here, we use in vivo two-photon imaging of genetically encoded voltage and calcium indicators, Arclight and GCaMP6f respectively, to measure responses in \textit{Drosophila} direction-selective T4 neurons. Comparison between Arclight and GCaMP6f signals revealed calcium signals to have a much higher direction selectivity compared to voltage signals. Using these recordings we build a model which transforms T4 voltage responses to calcium responses. The model reproduces experimentally measured calcium responses across different visual stimuli using different temporal filtering steps and a stationary non-linearity. These findings provide a mechanistic underpinning of the voltage-to-calcium transformation and show how this processing step, in addition to synaptic mechanisms on the dendrites of T4 cells, improves direction selectivity in the output signal of T4 neurons.

%Fluorescence changes in response to changes in neuronal calcium level have been widely used to study neural activity. More studies using voltage imaging and electrophysiology are now being done to record neural responses in \textit{Drosophila} visual circuit. However, the effect of voltage to calcium transformation on neural responses to different sensory stimuli have not been well understood. Here, we use in vivo, two-photon imaging of genetically encoded voltage \& calcium indicators - Arclight and GCaMP6f respectively, to measure responses in \textit{Drosophila} T4 neurons. Comparison between Arclight \& GCaMP6f signals revealed calcium signals to have significantly higher direction selectivity compared to voltage signals. Using these recordings we further build a model which transforms T4 voltage responses to calcium responses. The model reproduces calcium responses across different visual stimuli. These findings reveal that voltage to calcium transformation involving non-linearity \& low-pass filtering results in a higher direction selectivity in T4 cells.

\end{abstract}

\section{Introduction}
In order to guide animal behavior, neurons perform a wide range of computations. Neurons encode information via graded changes in membrane potential or action potential frequency. Mostly they communicate via chemical synapses which requires the release of neurotransmitters. When the presynaptic membrane is sufficiently depolarized, voltage-gated calcium channels open and allow $Ca^{2+}$ to enter the cell \parencite{Luo2020}. Calcium entry leads to the fusion of synaptic vesicles with the membrane and release of neurotransmitter molecules into the synaptic cleft \parencite{Chapman2002}.  As neurotransmitters diffuse across the synaptic cleft, they bind to receptors in the postsynaptic membrane, causing postsynaptic neuron to depolarize or hyperpolarize, passing the information from pre to postsynaptic neurons \parencite{Maio2008}. Voltage to calcium transformation in neurons is therefore a crucial step in neural information processing and neural computation. 

A classic example of neural computation is how \textit{Drosophila} neurons compute the direction of visual motion \parencite{Borst2020}. In \textit{Drosophila}, visual information is processed in parallel ON (contrast increments) and OFF (contrast decrements) pathways \parencite{Joesch2010, Eichner2011}. Direction selectivity emerges three synapses downstream of photoreceptors, in T4 and T5 for ON and OFF pathways respectively. Four subtypes of T4 and T5 cells exist, each responding selectively to one of the four cardinal directions \parencite{Maisak2013}. Amazingly, right at the first stage where direction selectivity emerges, T4 and T5 cells exhibit a high degree of direction selectivity, with no responses to null direction stimuli. This statement is, however, based on calcium recordings. Whole-cell patch clamp recordings show a somewhat different picture: While preferred direction stimuli also lead to large membrane depolarizations, edges or gratings moving along the null directions elicit smaller but significant responses as well \parencite{Groschner2022}. This hints to an additional processing step where voltage signals are transformed into calcium signals that increases direction selectivity of the cells. In order to study this step systematically, we recorded both voltage and calcium signals in response to a large stimulus set that includes gratings and edges moving along various directions at different speeds and contrasts. Using these data, we build a model that captures the transformation from voltage to calcium by a few linear and non-linear processing steps.


% The underlying mechanisms generating direction selectivity and cellular correlates implementing these mechanisms have been studied extensively over the years. Classically two opposing models have been proposed for the computation of direction selectivity. Both these models use two input lines, where one of the input line has been asymmetrically delayed compared to other, which is then followed by a nonlinear interaction. The Hassenstein-Reichardt (HR) model, proposes a preferred direction enhancement (PDE) \parencite{Hassenstein1956}, while Barlow-Levick (BL) model proposes a null direction suppression (NDS) \parencite{Barlow1965}. 

%Two major experimental approaches have been used to record signals from T4 \& T5 neurons. One approach has been to use changes in intracellular calcium concentration as an indicator for neural activity and the other has been to record changes in membrane potential as a proxy for neural activity. Studies in T4 \& T5 using calcium imaging have provided functional evidence for PDE \parencite{Fisher2015, Salazar-Gatzimas2016} and combination of both PDE \& NDS \parencite{Haag2016, Leong2016, Haag2017}. In contrast, \cite{Gruntman2018} using whole-cell patch clamp recording in T4 cells found NDS only. A study in T5 using voltage imaging of ASAP2f \parencite{Wienecke2018} found neither PDE nor NDS. A recent study using whole-cell patch clamp recordings \parencite{Groschner2022} has provided evidence for biophysical implementation of multiplication-like nonlinear operations in T4 neurons. This difference in findings between voltage and calcium studies requires further investigation of voltage to calcium transformation in T4 \& T5 neurons.

\section{Results}

We first expressed the genetically encoded calcium indicator GCaMP6f \parencite{Chen2013} in T4 cells projecting to layer 3 of the lobula plate. These cells have upward motion as their preferred direction (PD) and downward motion as their null direction (ND). We also expressed the genetically encoded voltage indicator Arclight \parencite{Jin2012} using the same driver line. Arclight's fluorescence decreases with membrane depolarization and increases with membrane hyperpolarization. To compare the voltage and calcium signals,  we recorded the neural activity in T4c cells dendrites in medulla layer 10 in response to the same set of stimuli using 2-photon microscopy \parencite{Denk1990}. The complete stimuli set included square-wave gratings of $30\degree$ spatial wavelength moving in 12 different directions, and ON edge moving in PD and ND, at four different speeds ($15\degree s^{-1}, 30\degree s^{-1}, 60\degree s^{-1}, 90\degree s^{-1}$) and four different contrasts ($10\%, 20\%, 50\%, 100\%$).

In a first set of experiments, we measured the voltage and calcium signals in response to gratings moving in PD and ND at four different speeds (figure \ref{PDNDspeed}A). As the grating stimuli consists of alternate bright and dark bars moving in a certain direction, there was a modulation in the Arclight (black traces) and GCaMP6f (red traces) responses to it. The GCaMP6f responses showed modulations only for slower speeds, while Arclight responses had modulations also for faster speeds. The response amplitudes were much higher for GCaMP6f ($\approx2.0 \Delta F/F$) compared to Arclight ($\approx -0.06 \Delta F/F$). The peak responses (maximum $\Delta F/F$) decreased with increasing stimulus speed both for GCaMP6f and Arclight (figure \ref{PDNDspeed}B). To understand if voltage to calcium transformation affects direction selectivity in T4 cells, we compared the responses to gratings moving in PD and ND. GCaMP6f responses in ND were negligible compared to its responses in PD, while for Arclight responses in ND were quite visible compared to responses in PD. We quantified the direction selectivity using a direction selectivity index (DSI) calculated as the difference of the peak responses to preferred and null direction, divided by the sum of the peak responses (see Materials and Methods equation \eqref{DSIequation}). The results reveal a high degree of direction selectivity of close to 1 for GCaMP6f at slower velocities, compared to a direction selectivity of $\approx0.4$ for Arclight (figure \ref{PDNDspeed}E). For both GCaMP and Arclight signals, direction selectivity decreased slightly with increasing velocity.

Next, instead of gratings, we used a moving bright edge with all other stimulus parameters remaining the same (figure \ref{PDNDspeed}C). As the edge moves upward on the screen, it crosses the receptive field of T4c neurons ($\approx15\degree$) only once. Hence, there was only a single peak in the response. The peak response decreased with increasing stimulus speed for GCaMP6f, while the peak response remained almost constant for Arclight throughout all speeds (figure \ref{PDNDspeed}D). When comparing edge responses moving along preferred and null directions, GCaMP6f showed negligible responses in null direction while Arclight revealed considerable responses to null direction stimuli. The direction selectivity index was again much higher for GCaMP6f compared to Arclight (figure \ref{PDNDspeed}F). Together these results show that GCaMP6f signals have a high level of direction selectivity compared to Arclight signals, both for grating and edge stimuli.

%Spatial contrast i.e. the difference between adjacent luminance values, provides information about objects, textures, and motion and is important for diverse visual processes. We were therefore interested in comparing voltage and calcium signal for different contrast conditions since contrast computation is essential to visual perception. 
The stimulus strength was further varied by changing the contrast between bright and dark bars for gratings and between moving edge and background for edge stimuli. We measured Arclight and GCaMP6f responses to gratings moving at $30\degree s^{-1}$ at four different contrasts (figure \ref{PDNDcontrast}A). Increasing contrast increases stimulus strength, resulting in an increase in response for both Arclight and GCaMP6f. GCaMP6f signals were modulated at the temporal frequency of the grating but showed an additional rise over time. This slow increase was not observed in Arclight signals. We also measured Arclight and GCaMP responses to ON edges moving at the same speed but having different contrasts (figure \ref{PDNDcontrast}C). The peak response (maximum $\Delta F/F$) increased with increasing contrast (figure \ref{PDNDcontrast}D). Similar to previous experiments, the direction selectivity index was much higher for GCaMP6f ($\approx1.0$) compared to that for Arclight ($\approx0.4$) (figure \ref{PDNDcontrast}E,F). 

In the results presented so far we compared responses for two directions only, i.e. along the preferred (upward) and along the null direction (downward). We next wanted to extend the comparison to motion along 12 directions, from $0\degree$ to $360\degree$ in steps of $30\degree$. For this comparison, we determined the normalized peak responses of Arclight and GCaMP6f signals to gratings moving in 12 directions at 4 different speeds and 4 different contrasts, respectively (figure \ref{DirTuning}A, B). The directional tuning was much sharper for GCaMP6f compared to Arclight. To quantify this we calculated the directional tuning index $L_{dir}$ \parencite{Mazurek2014} for each speed and each contrast as the vector sum of the peak responses divided by the sum of all individual vector magnitudes (equation \eqref{Ldirequation}). In general, the directional tuning indices again were much higher for GCaMP6f ($\approx0.7$) compared to that of Arclight ($\approx0.2$) (figure \ref{DirTuning}C, D). These results together show that GCaMP6f signals have a higher degree of directional tuning across different speeds and contrasts than Arclight.

How does the voltage to calcium transformation lead to calcium signals with significantly higher directional tuning compared to voltage signals? To address this question, we constructed an algorithmic model (figure \ref{Modelillustration}) which takes Arclight signals as inputs and outputs GCaMP signal. In order to find the optimal parameter values, we first defined an error function. For each stimulus condition, the error was calculated as the sum of the squared difference between the model and experimental data at each time-point (equation \eqref{error}). There were a total of 112 stimulus conditions: gratings speed (48), gratings contrast (48), edge speed (8) and edge contrast (8). Thus, the total error amounted to the sum of errors across all stimulus conditions (equation \eqref{totalerror}). We then found the optimal parameters values of the model that correspond to the minimum total error using Python SciPy optimize minimize function \parencite{Virtanen2020}.

We started with a simple model (figure \ref{Modelillustration}A). The model first passes the Arclight signal through a high-pass filter. The high-pass filter brings the input Arclight signal closer to the actual voltage signal by removing the slowly fluctuating Arclight indicator dynamics. This is followed by a threshold, assuming that the voltage changes below a certain threshold does not affect the calcium level in the cell. Now, few experimental observations which we took into consideration for building up the model further were as follows : First, the GCaMP6f response to gratings showed modulations only for slower speeds, whereas Arclight response had modulations even at faster speeds (figure \ref{PDNDspeed}A). This suggests that the GCaMP6f signal is a low-pass filtered version of the Arclight signal. In the simple model, we used a single low-pass filter followed by a gain and time-shift. Multiplication with a gain factor was required since GCaMP6f signals have a much higher magnitude compared to Arclight. Arclight and GCaMP6f responses were recorded from cells in different flies with different receptive fields, therefore the responses can have different phases, and a time-shift is necessary to align the signals. However, the simple model with single low-pass filter could not reproduce responses across all stimuli. To compare the model performances, we defined a model error as the total error divided by the power of the data (equation \eqref{modelerror}). The model error for the complete dataset fit for the simple model was around $34\%$. Specifically, the simple model failed to reproduce the edge responses. Second, the GCaMP6f responses in addition to modulation also had a steady rise over time whereas Arclight signal only had modulations (figure \ref{PDNDspeed}A, \ref{PDNDcontrast}A). For reproducing the edge responses and modulation in grating responses, the model needed a low-pass filter with a small time constant. However to simulate the steady rise in the grating signal, a low-pass filter with a large time constant was necessary. Hence, we combined the output of two low-pass filters. Summing up the low-pass filter outputs (figure \ref{Modelillustration}B) did not lead to much improvement. However, combining both outputs from the low-pass filters with a multiplication led to significant decrease in the error. The model error for the multiplicative model (figure \ref{Modelillustration}C) then was around $20\%$. 

The multiplicative model thus has in total 6 parameters - high-pass filter time constant, threshold, low-pass filter 1 time constant, low-pass filter 2 time constant, gain and shift.  The multiplicative model was able to reproduce calcium signals across different visual stimuli (figure \ref{PDNDModel}). It could reproduce both the modulation as well as slow rise in the GCaMP6f signal in response to gratings (figure \ref{PDNDModel}A). The model could also reproduce the ON edge speed tuning responses across different speeds (figure \ref{PDNDModel}C,D). The directional tuning index $L_{dir}$ were similar for model and experimental data across slower speeds and all contrasts (figure \ref{PDNDModel}E,F). Thus the model was able to successfully reproduce experimental calcium data across different stimuli.  

Is the slow rise in GCaMP6f signals over time due to the properties of T4 cells or due to the properties of GCaMP6f? To answer this question we used a faster version of the calcium indicator GCaMP8f \parencite{Zhang2020}. GCaMP8f was expressed in T4c cells using the same driver line. The experiments were repeated using grating stimuli in 12 directions at 4 speeds and ON edges moving in PD and ND. T4c cells GCaMP8f responses were similar to GCaMP6f responses but faster. As with GCaMP6f, GCaMP8f signals had modulation and slow rise over time. We further compared the model parameters values for GCaMP6f data fit and GCaMP8f data fit (figure \ref{gcampcomparison}). The model parameters were similar with time constants having smaller values for GCAMP8f as it is a faster indicator. Therefore, the slow rise in the calcium signal is not due to the properties of GCaMP6f indicator. 

While the T4 cells' Arclight responses to gratings show only modulation, their GCaMP responses show modulation and slow increases over time. Does this response occur exclusively in direction-selective T4 cells or does it also occur in non-direction-selective cells? In order to answer this question, we expressed Arclight \& GCaMP6f in medulla neurons Mi1 \& Tm3 cells, which are both non-direction-selective. Mi1 and Tm3 are pre-synaptic to T4 cells and have ON-center receptive field \parencite{Behnia2014, Arenz2017}. We measured Mi1, Tm3 Arclight (black) and GCaMP6f (red) responses to gratings moving at 4 different speeds and to gratings moving at 4 different contrasts (figure \ref{Mi1Tm3data}). The gratings were moved in only one direction, since the direction does not affect non-direction-selective cells' responses. Contrary to T4, Mi1 GCaMP6f responses had only modulation without a slow increase over time (figure \ref{Mi1Tm3data}A). Tm3 GCaMP responses did not increase over time, and showed only modulation for gratings moving at $15\degree s^{-1}$. For gratings moving at $30\degree s^{-1}$ and $60\degree s^{-1}$, there was an increase in Tm3 GCaMP6f response over time, but the Arclight response also already had a slow increment over time (figure \ref{Mi1Tm3data}A). Similar to T4, the peak response for Mi1 and Tm3 decreased with an increase in speed and increased with an increase in contrast (figure \ref{Mi1Tm3data}B, D). Together, these results show that voltage to calcium transformation causes GCaMP6f response increment over time only for direction-selective T4 cells and not for non-direction-selective Mi1 and Tm3 cells.

Next, we used the model described in figure \ref{Modelillustration} to reproduce Mi1 and Tm3 calcium responses using their Arclight responses. As discussed earlier, the simple model (figure \ref{Modelillustration}A) with single low-pass filter was not able to reproduce T4 calcium responses across all stimuli. However, for Mi1 and Tm3, the simple model with a single low-pass filter was able to reproduce the calcium responses across all stimuli conditions (figure \ref{Mi1Tm3model}). The model also accurately replicated the speed and contrast tuning for Mi1 and Tm3 (figure \ref{Mi1Tm3model}B, D). We further compared the model error for simple and multiplicative model for Mi1, Tm3 and T4c data (figure \ref{FitError}). The model error for Mi1 and Tm3 for simple model was $\approx6.5\%$ and $\approx5.9\%$ respectively compared to $\approx11.9\%$ and $\approx7\%$ for the multiplicative model. Thus, the simple model already performed well for Mi1 and Tm3 dataset, and changing to multipicative model did not improve the performance. For the T4c dataset the model error was $\approx34\%$ and  $\approx21\%$ for the simple and multiplicative model respectively. Hence, the multiplicative model with two low-pass filters performed better for T4c dataset whereas for Mi1 and Tm3 the Simple model with single low-pass filter was sufficient to reproduce the calcium responses. This suggests that voltage-to-calcium transformation is more complex for direction-selective cell T4 than for the non-direction-selective cells Mi1 and Tm3.

\section{Discussion}
Neuronal signalling and information processing involves the transformation of membrane voltage into calcium signals, which lead to transmitter release. Computations can occur in the transformation between voltage and calcium or between calcium and neurotransmitter release. T4 neurons are the first direction-selective neurons found in the \textit{Drosophila} ON motion vision pathway. Intriguingly, however, a high degree of directional selectivity is observed already at the first stage, i.e. in T4 cells. In this study, we found that the voltage to calcium transformation in T4c neurons improves direction selectivity, and calcium signals in T4c cells have a much higher direction selectivity and tuning compared to membrane voltage across different stimuli conditions (figure \ref{PDNDspeed}-\ref{DirTuning}). As calcium is required for neurotransmitter release, this would increase direction selectivity of T4c output signals. 

Electrophysiology has been the most frequently used method to measure the membrane potential changes in neurons. However, due to the small size of neurons in the optic lobe, single-cell electrophysiological recordings of these neurons have been difficult. Genetically encoded voltage indicators (GEVIs) have evolved as powerful tools for recording changes in neuronal membrane potentials. Optical methods of monitoring brain activity are appealing because they allow simultaneous, noninvasive monitoring of activity in many individual neurons. We used a fluorescence protein (FP) voltage sensor called Arclight \parencite{Jin2012}. Arclight is based on the fusion of voltage sensing domain of \textit{Ciona intestinalis} voltage sensitive phosphatase \parencite{Murata2005} and the fluorescent protein super ecliptic pHluorin with an A227D mutation. Arclight has been shown to robustly report both subthreshold events and action potentials in genetically targeted neurons in the intact \textit{Drosophila} brain \parencite{Cao2013}. 

We further built a model to capture voltage to calcium transformation in T4c, Mi1 and Tm3 cells. A simple model with a single low-pass filter was able to reproduce calcium responses in non-direction-selective Mi1 and Tm3 cells (figure \ref{Mi1Tm3model}), whereas a more complex model combining output of two low-pass filters via a multiplication was required to reproduce T4c calcium responses (figure \ref{Modelillustration}). This suggests that voltage-calcium transformation in Mi1 and Tm3 cells is different from those in T4c cells. Differential expression of voltage-gated calcium channels in these cells could explain the different voltage to calcium transformation. Voltage-gated calcium channels mediate depolarization-induced calcium influx that drives release of neurotransmitter. The $\alpha1$-subunit of the voltage-gated calcium channels forms the ion-conducting pore, which makes it distinct from other calcium channels. Three families of genes encode $\alpha1$ subunits. \textit{Drosophila} genome has one $\alpha1$ subunit gene in each family: $\alpha1D$ ($Ca_{v}1$), cac ($Ca_{v}2$), and $\alpha1T$ ($Ca_{v}3$) \parencite{Littleton2000, King2007}. In Drosophila antennal lobe projection neurons, cac ($Ca_{v}2$) type and $\alpha1T$ ($Ca_{v}3$) type voltage-gated calcium channels are involved in sustained and transient calcium currents, respectively \parencite{Gu2009, Iniguez2013}. According to a RNA-sequencing study \parencite{Davis2020}, $\alpha1T$ ($Ca_{v}3$) mRNA have higher expression in Mi1 ($2050.16$ Transcripts per Million (TPM)) compared to T4 ($686.68$ TPM) and Tm3 ($336.45$ TPM). While cac ($Ca_{v}2$) mRNA have higher expression in T4 ($1298.53$ TPM) compared to Mi1 ($986.25$ TPM) and Tm3 ($817.61$ TPM). Different expression of voltage-gated calcium channels could cause different voltage to calcium transformations in non-direction selective and direction-selective cells.

\section{Materials and Methods}
\subsection{Flies}
Flies (\textit{Drosophila melanogaster}) were raised at $25\degree C$ and $60\%$ humidity on a $12$ hour light/$12$ hour dark cycle on standard cornmeal agar medium. For calcium imaging experiments, genetically-encoded calcium indicator GCaMP6f \parencite{Chen2013} was expressed in T4 neurons with axon terminals predominantly in  layer 3 of the lobula plate. Similarly for voltage imaging experiments, genetically-encoded voltage indicator Arclight \parencite{Jin2012} was expressed in T4 layer 3 neurons. The flies genotype were as follows : 
\begin{enumerate}
\item T4c>GCaMP6f :	w+ ; VT15785-Gal4AD / UAS-GCaMP6f; VT50384-Gal4DBD / UAS-GCaMP6f 
\item T4c>Arclight :	w+ ; VT15785-Gal4AD / UAS-Arclight; VT50384-Gal4DBD / + 
\end{enumerate}

For Mi1 and Tm3 experiments, the flies genotype were as follows :
\begin{enumerate}
\item Mi1>GCaMP6f :		w+ ; R19F01-Gal4AD / UAS-GCaMP6f; R71D01-Gal4DBD / UAS-GCaMP6f 
\item Mi1>Arclight :		w+ ; R19F01-Gal4AD / UAS-Arclight; R71D01-Gal4DBD / +
\item Tm3>GCaMP6f :		w+ ; R13E12-Gal4AD / UAS-GCaMP6f; R59C10-Gal4DBD / UAS-GCaMP6f 
\item Tm3>Arclight :		w+ ; R13E12-Gal4AD / UAS-Arclight; R59C10-Gal4DBD / +

\end{enumerate}

\subsection{Calcium \& voltage imaging}
For imaging experiments, fly surgeries were performed as previously described \parencite{Maisak2013}. Briefly, flies were anaesthetized with CO$_2$ or on ice, fixed with their backs, legs and wings to a Plexiglas holder with back of the head exposed to a recording chamber filled with fly external solution. The cuticula at the back of the head on one side of the brain was cut away with a fine hypodermic needle and removed together with air sacks covering the underlying optic lobe. The neuronal activity was then measured from optic lobe on a custom-built 2-photon microscope as previously described \parencite{Maisak2013}. Images were acquired at 64 x 64 pixels resolution and frame rate 13 Hz with the Scanimage software in Matlab  \parencite{Pologruto2003}.

\subsection{Visual stimulation}
For the study of visual responses of T4c cells, visual stimuli were presented on a custom-built projector-based arena as described in \parencite{Arenz2017}. In brief : Two micro-projectors (TI DLP Lightcrafter 3000) were used to project stimuli onto the back of an opaque cylindrical screen covering $180\degree$ in azimuth and $105\degree$ in elevation of the fly's visual field. To increase the refresh rate from 60 Hz to 180 Hz (at 8 bit color depth), projectors were programmed to use only green LED (OSRAM L CG H9RN) which emits light between 500 nm to 600 nm wavelength. Two long-pass filters (Thorlabs FEL0550 and FGL550) were placed in front of each projector to restrict the stimulus light to wavelengths above 550 nm. This prevents overlap between GCaMP signal and arena light spectra. To allow only GCaMP emission spectrum to be detected, a band-pass filter (Brightline 520/35) was placed in-front of the photomultiplier. For all stimuli used here, we set the medium brightness to a 8-bit grayscale value of 50, which corresponds to a medium luminance of $55 \pm 11 cd/m^2$. Stimuli were rendered using custom written software in Python 2.7. 

\subsubsection{Stimuli}
Stimuli were presented with 3-5 repetitions per experiment in a randomized fashion. To measure the directional and speed tuning, square-wave gratings with a spatial wavelength of $30\degree$ spanning the full extent of the stimulus arena were used. The gratings were moved in 12 different directions from $0\degree - 360\degree$ at 4 different speeds ($15\degree s^{-1},30\degree s^{-1},60\degree s^{-1},120\degree s^{-1}$). Similarly, to measure direction and contrast tuning, square-wave gratings with a spatial wavelength of $30\degree$ spanning the full extent of the stimulus arena were used. The gratings moved at a speed of $30\degree s^{-1}$ in 12 different directions at 4 different contrasts ($10\%, 20\%, 50\%, 100\%$). Edge responses were measured using ON edge i.e. bright edge moving on a dark background with full contrast. The ON edge moved in preferred direction (upward) or null direction (downward) at 4 different speeds ($15\degree s^{-1},30\degree s^{-1},60\degree s^{-1},120\degree s^{-1}$).

\subsection{Data analysis}
Data analysis was performed using custom-written routines in Matlab and Python 2.7, 3.7. Images were automatically registered using horizontal and vertical translations to correct for the movement of brain. Fluorescence changes $(\Delta F/F)$ were then calculated using a standard baseline algorithm \parencite{Jia2011}. Regions of interest (ROIs) were drawn on the average raw image manually by hand in the medulla layer M10 for signals from T4 dendrites. Averaging the fluorescence change over this ROI in space resulted in a $(\Delta F/F)$ time course. Voltage imaging with Arclight and calcium imaging with GCaMP6f and GCaMP8f were performed and analysed using same settings.

The direction selectivity was evaluated using a direction selectivity index (DSI) calculated as the difference of the peak responses to preferred and null direction, divided by the sum of the peak responses:
\begin{equation}
DSI = \frac{PD_{peak} - ND_{peak}}{PD_{peak} + ND_{peak}}
\label{DSIequation}
\end{equation}
In the above measurement, only the difference in response between the two opposing directions of motion is quantified. To take into account all 12 directions of motion, we calculated the directional tuning index:
\begin{equation}
L_{dir} = \left|\frac{\sum_{\varphi}^{}{\vec{v}(\varphi)}}{\sum_{\varphi}^{}{|\vec{v}(\varphi)|}}\right|
\label{Ldirequation}
\end{equation}
where $\vec{v}(\varphi)$ is a vector proportionally scaled with the mean response and points in the direction corresponding to the direction of motion given by the rotation angle $\varphi$ of the stimulus \parencite{Mazurek2014}.

\subsection{Model simulations}
Custom-written Python3.7 scripts were used to simulate the models (figure \ref{Modelillustration}). To calculate the optimal parameter values, we first defined an error function. For each stimulus condition ($s_{i}$), the error was calculated as: 
\begin{equation}
error(s_{i}) = \sum_{t=0}^{t=N} (model (s_{i}t) - data (s_{i}t))^2
\label{error}
\end{equation}
The model took as input Arclight data across all 112 different stimuli conditions. Next, we summed the error for all stimuli conditions: 
\begin{equation}
total\, error = \sum_{i=1}^{i=112} error(s_{i})
\label{totalerror}
\end{equation}
The model parameters were first assigned a random value within the defined parameter bounds. Python SciPy optimize minimize function then used the L-BFGS-B (Limited Broyden Fletcher Goldfarb Shanno) algorithm to find the parameter values corresponding to the minimum total error. A total of 300 runs were performed, and the parameter values that corresponded to the run with the lowest error were used to produce the final output signals. To compare the model performances, we calculated the model error as: 
\begin{equation}
model \, error \, [\% \, of \, data \, power] = \frac{total \, error}{\sum_{i=1}^{i=112}(data(s_{i}))^2} 
\label{modelerror}
\end{equation}

\printbibliography[heading=bibintoc]

\begin{figure}
\begin{fullwidth}
\includegraphics[width=0.84\linewidth]{figure1}
	%\includegraphics[height = 8cm]{Mi1_Medulla_GtACR}
\caption{\textbf{T4c speed dependence} : (A) T4c Arclight (black) and GCaMP6f (red) responses to grating moving in PD (top row) and ND (bottom row) at 4 different speeds. The plots have twin y-axis. The left y-axis of the plot represents voltage responses i.e. changes in Arclight fluorescence ($-\Delta F/F$) and the right y-axis of the plot represents calcium responses i.e. changes in GCaMP6f fluorescence ($\Delta F/F$) (B) T4c peak responses to grating moving in PD (top) and ND (bottom) at 4 different speeds. (C) T4c Arclight (black) and GCaMP6f (red) responses to ON-edge moving in PD (top row) and ND (bottom row) at 4 different speeds. (D) T4c peak responses to ON-edge moving in PD and ND at 4 different speeds. (E) Direction selectivity index (DSI) calculated as difference of peak responses in PD and ND divided by the sum of peak responses for grating (F) Direction selectivity index (DSI) for ON-edge. All data shows the mean $\pm$ SEM measured in 5 different flies. PD: preferred direction, ND: null direction.}

\label{PDNDspeed}
	
\end{fullwidth}
\end{figure} 

\begin{figure}
\begin{fullwidth}
\includegraphics[width=0.84\linewidth]{figure2}
	%\includegraphics[height = 8cm]{Mi1_Medulla_GtACR}
\caption{\textbf{T4c contrast dependence} : (A) T4c Arclight (black) and GCaMP6f (red) responses to grating moving in PD (top row) and ND (bottom row) at 4 different contrasts. The plots have twin y-axis. The left y-axis of the plot represents voltage responses i.e. changes in Arclight fluorescence ($-\Delta F/F$) and the right y-axis of the plot represents calcium responses i.e. changes in GCaMP6f fluorescence ($\Delta F/F$) (B) T4c peak responses to grating moving in PD (top) and ND (bottom) at 4 different contrasts. (C) T4c Arclight (black) and GCaMP6f (red) responses to ON-edge moving in PD (top row) and ND (bottom row) at 4 different contrasts. (D) T4c peak responses to ON-edge moving in PD and ND at 4 different contrasts. (E) Direction selectivity index (DSI) calculated as difference of peak responses in PD and ND divided by the sum of peak responses for grating (F) Direction Selectivity Index (DSI) for ON-edge. All data shows the mean $\pm$ SEM measured in 5 different flies.}

\label{PDNDcontrast}
	
\end{fullwidth}
\end{figure} 

\begin{figure}
\begin{fullwidth}
\includegraphics[width=0.84\linewidth]{figure3}
	%\includegraphics[height = 8cm]{Mi1_Medulla_GtACR}
\caption{\textbf{T4c direction tuning} : (A) T4c Arclight (black) and GCaMP6f (red) normalized peak responses to grating moving in 12 directions at 4 different speeds. (B) T4c Arclight (black) and GCaMP6f (red) normalized peak responses to grating moving in 12 directions at 4 different contrasts. (C) The directional tuning index $L_{dir}$ for grating moving at 4 different speeds. The directional tuning index is calculated as the vector sum of the peak responses divided by the sum of all individual vector magnitudes. (D) The directional tuning index for grating at 4 different contrasts. All data shows the mean $\pm$ SEM measured in 5 different flies.}

\label{DirTuning}
	
\end{fullwidth}
\end{figure} 

\begin{figure}
\begin{fullwidth}
\includegraphics[width=0.84\linewidth]{figure4}
	%\includegraphics[height = 8cm]{Mi1_Medulla_GtACR}
\caption{\textbf{Models for voltage to calcium transformation} : (A) Simple model consisting of High-Pass filter (HP), threshold (trld), Low-Pass filter (LP), gain and shift. (B) Additive model combining output of two low-pass filters via addition. (C) Multiplicative model combining output of two low-pass filters via multiplication. }

\label{Modelillustration}
	
\end{fullwidth}
\end{figure} 

\begin{figure}
\begin{fullwidth}
\includegraphics[width=0.84\linewidth]{figure5}
	%\includegraphics[height = 8cm]{Mi1_Medulla_GtACR}
\caption{\textbf{Multiplicative model responses} : (A) T4c GCaMP6f (red) and multiplicative model (green) responses to grating moving in PD (top row) and ND (bottom row) at 4 different speeds. (B) T4c GCaMP6f and model peak responses to grating moving in PD (top) and ND(bottom) at 4 different speeds. (C) T4c GCaMP6f (red) and multiplicative model (green) responses to ON-edge moving in PD (top row) and ND (bottom row) at 4 different speeds. (D) T4c GCaMP6f and model peak responses to ON-edge moving in PD (top) and ND (bottom) at 4 different speeds. (E) The directional tuning index $L_{dir}$ for GCaMP6f and model for grating moving in 12 directions at 4 different speeds. (F) The directional tuning index $L_{dir}$ for GCaMP6f and model for grating moving in 12 directions at 4 different contrasts.}

\label{PDNDModel}
	
\end{fullwidth}
\end{figure} 

\begin{figure}
\begin{fullwidth}
\includegraphics[width=0.84\linewidth]{figure6}
	%\includegraphics[height = 8cm]{Mi1_Medulla_GtACR}
\caption{\textbf{Model parameters for GCaMP6f (A) and GCaMP8f (B)} : Data shows mean $\pm$ SD for optimal parameters for the multiplicative model. The data were fit for grating moving in 12 directions and 4 speeds, and for ON-edge moving in PD and ND at 4 speeds. trld : threshold, HP : High Pass, LP : Low Pass, tc : Time constant}

\label{gcampcomparison}
	
\end{fullwidth}
\end{figure} 

\begin{figure}
\begin{fullwidth}
\includegraphics[width=0.84\linewidth]{figure7}
	%\includegraphics[height = 8cm]{Mi1_Medulla_GtACR}
\caption{\textbf{Mi1, Tm3 speed and contrast dependence} : (A) Mi1 Arclight (black) and GCaMP6f (red) responses to grating moving at 4 different speeds. The plots have twin y-axis. The left y-axis of the plot represents voltage responses i.e. changes in Arclight fluorescence ($-\Delta F/F$) and the right y-axis of the plot represents calcium responses i.e. changes in GCaMP6f fluorescence ($\Delta F/F$) (B) Mi1 peak responses to grating moving at 4 different speeds. (C) Mi1 Arclight (black) and GCaMP6f (red) responses to grating moving at 4 different contrasts. (D) Mi1 peak responses to grating moving at 4 different contrasts. All data shows the mean $\pm$ SEM measured in 5 different flies.}

\label{Mi1Tm3data}
	
\end{fullwidth}
\end{figure} 

%\begin{figure}
%\begin{fullwidth}
%\includegraphics[width=0.84\linewidth]{figure8}
%	%\includegraphics[height = 8cm]{Mi1_Medulla_GtACR}
%\caption{\textbf{Tm3 voltage \& calcium speed, contrast tuning} : (A) Tm3 Arclight (black) \& GCaMP (red) responses to grating moving at 4 different speeds. Data shows the mean $\pm$ SEM of Tm3 cell responses measured in 5 different flies. The plots have twin y-axis. The left y-axis of the plot represents Voltage responses i.e. changes in Arclight fluorescence ($-\Delta F/F$) and the right y-axis of the plot represents Calcium responses i.e. changes in GCaMP fluorescence ($\Delta F/F$) (B) Tm3 peak responses to grating moving at 4 different speeds. (C) Tm3 Arclight (black) \& GCaMP (red) responses to grating moving at 4 different contrasts. Data shows the mean $\pm$ SEM of Tm3 cell responses measured in 5 different flies. (D) Tm3 peak responses to grating moving at 4 different contrasts.}
%
%\label{Tm3data}
%	
%\end{fullwidth}
%\end{figure} 

\begin{figure}
\begin{fullwidth}
\includegraphics[width=0.84\linewidth]{figure8}
	%\includegraphics[height = 8cm]{Mi1_Medulla_GtACR}
\caption{\textbf{Mi1, Tm3 Simple model responses} : (A) Mi1 GCaMP6f (red) and model (green) responses to gratings moving at 4 different speeds (top row) and to gratings moving at 4 different contrasts (bottom row). (B) Mi1 GCaMP6f and model peak responses to gratings moving at 4 different speeds (top) and 4 different contrasts (bottom). (C) Tm3 GCaMP6f (red) and model (green) responses to gratings moving at 4 different speeds (top row) and to gratings moving at 4 different contrasts (bottom row). (D) Tm3 GCaMP6f and model peak responses to gratings moving at 4 different speeds (top) and 4 different contrasts (bottom).}

\label{Mi1Tm3model}
	
\end{fullwidth}
\end{figure} 

\begin{figure}
\begin{fullwidth}
\hspace*{2cm}\includegraphics[width=0.84\linewidth]{figure9}
	%\includegraphics[height = 8cm]{Mi1_Medulla_GtACR}
\caption{\textbf{Model error for the simple and multiplicative model} : The model error for the simple model (blue) and multiplicative model (orange). Mi1 and Tm3 dataset consists of gratings at 4 different speeds and contrast moving in a single direction. T4c complete dataset consists of gratings moving in 12 different directions, and ON edge moving in PD, ND at 4 different speeds and contrasts i.e. a total of 112 stimuli conditions.}

\label{FitError}
	
\end{fullwidth}
\end{figure} 

\end{document}
